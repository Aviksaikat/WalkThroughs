# Pentesterlab Authorization

> Saikat Karmakar | AUG 19 : 2021

---

-	http://url/users/1.json (check for json files)

-	When people started building website with database to store information, they had to do a lot of SQL manually. Few people realized that it was not the best solution and started working on smarter alternatives and started building Object-relational mapping (ORM) to easily query the database without any SQL knowledge. For example, in Ruby (using ActiveRecord), you can do things like:

	@user = User.find_by_name('pentesterlab')

	This will automatically generate and execute the query and retrieve the result in a User object.

	Another really handy usage was to automatically create and update an object from a hash:

	@user = User.create(myhash) 
	[...]
	@user.update_attributes(anotherhash)

	Unfortunately, this useful feature comes with a security price, if a developer did not correctly ensure that attributes of the object @user were protected, an attacker could arbitrarily overwrite any of these attributes. In this section, we will see some common examples of these types of issues: Mass-Assignment.

	In this example, you can register a user. The application has two levels of privileges:

	    User.
	    Admin.

	The admin privilege is set using the attribute admin on the object user. If you look closely at the format used by the web application: user[username] and user[password], you should be able to find a way to get admin access. Three methods can be used:

	    Modify the page directly using a browser extension.
	    Save the page and modify offline to create a page that will send the right payload to the right URL.
	    Use a proxy to intercept the legitimate request and add your parameter (fastest option).

-	`user[username]=user2&user[password]=a&submit=Submit&&user[admin]=1`

-	In this exercise, you can register an account. However, you won't be part of an 	organisation. The goal is to join the organisation Organisation #1

	To do so you will need to set your organisation using mass-assignment.

	By convention (can be changed programmatically) when a developer uses ActiveRecord (Ruby-on-Rails' most common data mapper), and a class Organisation has multiple User, the relation is managed using a field organisation_id inside the User class:

	The following code is used in Ruby:
	```ruby
	class User < ActiveRecord::Base
	  belongs_to :organisation
	end

	class Organisation < ActiveRecord::Base
	  has_many :users
	end
	```

	You can guess the fact that organisation is used by visiting the organisation page and looking at the URL. You will see that the class is probably named Organisation. And therefore the key in the users table is likely to be organisation_id.

	user[username]=a&user[password]=a&submit=Submit&user[organisation_id]=1

	